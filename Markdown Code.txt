    // Process markdown on the HTML body.
    function markdownHtmlBody (next) {

      // Skip if no HTML body.
      if (!email.htmlBody) { return next(null); }

      // Skip if we aren't processing markdown.
      if (!markdown) { return next(null); }

      // Default options (as per "marked" module).
      var defaultOptions = {
        gfm:         true,
        tables:      true,
        breaks:      false,
        pedantic:    false,
        sanitize:    true,
        smartLists:  true,
        smartypants: false
      };

      // Merge default options with global and instance options.
      var finalOptions = objectAssign({}, defaultOptions, markdown);

      // Set markdown options.
      marked.setOptions(finalOptions);

      // Parse markdown.
      marked(email.htmlBody, function (err, output) {

        if (err) { return next(err); }

        // Save and continue.
        email.htmlBody = output;
        return next(null);

      });

    },
    
    
    
    
    
#### Markdown Options
See [Marked](https://www.npmjs.com/package/marked) for explanations of the options that can be used to configure the markdown parser. By default the following options will be used:

```javascript
markdown: {
  gfm:         true,
  tables:      true,
  breaks:      false,
  pedantic:    false,
  sanitize:    true,
  smartLists:  true,
  smartypants: false
}
```